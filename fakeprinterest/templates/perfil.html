{% extends "homepage.html" %}

{% block titulo %}
Perfil - {{ usuario.username }}
{% endblock %}

{% block body %}
<body>
{% include "navebar.html" %}

<div class="container">

    {% if form and form.foto %}
    <!-- Formulário de envio de foto -->
    <form class="bloco-add-img" method="POST" enctype="multipart/form-data">
        {{ form.csrf_token }}
        <h2>{{ usuario.username }} - Enviar foto</h2>

        <div class="bloco-arquivo">
            <label for="foto" class="botao-arquivo">
                Escolher arquivo
                {{ form.foto(class="input-arquivo", id="foto") }}
            </label>
            <span id="imagem-arquivo" class=""></span>
        </div>

        <div class="div-input">
            {{ form.descricao.label(class="label") }}
            {{ form.descricao(class="input") }}
        </div>

        {{ form.botao_confirmacao(class="botao-login") }}
    </form>

    {% elif form %}
    <!-- Outro formulário genérico, ex: FormConta -->
    <form method="POST" class="bloco-add-img">
        {{ form.csrf_token }}
        <h2>{{ usuario.username }} - Formulário</h2>
        {% for field in form %}
            {% if field.type != 'CSRFToken' and field.name != 'botao_confirmacao' %}
            <div class="div-input">
                {{ field.label(class="label") }}
                {{ field(class="input") }}
            </div>
            {% endif %}
        {% endfor %}
        {{ form.botao_confirmacao(class="botao-login") }}
    </form>

    {% else %}
    <!-- Perfil de outro usuário sem formulário -->
    <div class="bloco-add-img">
        <h2>{{ usuario.username }} - Ver Perfil</h2>
    </div>
    {% endif %}

    <!-- Galeria de fotos do usuário -->
    <div class="conteudo">
        {% for foto in usuario.fotos %}
        <div class="bloco-imagem">
            <img src="{{ url_for('static', filename='fotos_posts/' + foto.imagem) }}" alt="{{ foto.descricao }}">
        </div>
        {% endfor %}
    </div>

</div>

<script>
    // Mostrar nome do arquivo selecionado
    let input = document.getElementById("foto");
    let imagemArquivo = document.getElementById("imagem-arquivo");

    if (input) {
        input.addEventListener("change", () => {
            let inputImagem = document.querySelector("input[type=file]").files[0];
            if (inputImagem) {
                imagemArquivo.classList.add("visivel");
                imagemArquivo.innerText = inputImagem.name;
            }
        });
    }
</script>

</body>
{% endblock %}
